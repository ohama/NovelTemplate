---
phase: 01
plan: 02
name: /novel:init Command
wave: 2
depends_on: [01-01]
files_modified:
  - claude_src/novel/commands/init.md
  - claude_src/novel/templates/premise.md
  - claude_src/novel/templates/characters.md
  - claude_src/novel/templates/world.md
  - claude_src/novel/templates/style_guide.md
  - claude_src/novel/templates/timeline.md
  - claude_src/novel/templates/constraints.md
  - .claude/commands/novel/init.md
autonomous: true
---

# Plan 01-02: /novel:init Command

## Objective

Build the `/novel:init` command that initializes a novel project with directory structure, state files, and canon templates. This command is the entry point for all users and must be robust, user-friendly, and self-documenting.

**User Experience Goal:** First-time user can run `/novel:init` and immediately understand what to do next without reading docs.

---

## Tasks

<task id="01-02-01">
<description>
Create all 6 self-documenting canon file templates.

Each template must:
- Use Markdown format with clear section headers
- Include inline help with [bracketed placeholders]
- Provide embedded examples demonstrating quality
- Explain what each field means without external docs
- Be parseable by agents (consistent structure)
- Include bottom note explaining enforcement mechanism
- Match research specifications exactly (lines 505-913)

Templates:
- premise.md: Genre, logline, theme, story arc, tone
- characters.md: Protagonist, antagonist, supporting characters with arcs
- world.md: Setting, rules (physical/social/economic), institutions, conflicts
- style_guide.md: POV, tense, voice, forbidden phrases, motifs
- timeline.md: Anchor dates, sequences, constraints, seasonal markers
- constraints.md: Content boundaries, genre conventions, continuity rules
</description>

<files>
- claude_src/novel/templates/premise.md
- claude_src/novel/templates/characters.md
- claude_src/novel/templates/world.md
- claude_src/novel/templates/style_guide.md
- claude_src/novel/templates/timeline.md
- claude_src/novel/templates/constraints.md
</files>

<verification>
1. All 6 template files exist in claude_src/novel/templates/
2. Each template includes clear section headers (##)
3. All fields use [bracketed placeholder] format
4. At least one inline example per template showing expected quality
5. Bottom note on each explains which agent enforces the rules
6. premise.md includes: Genre, Format, Logline, Theme Statement, Opening/Ending Image
7. characters.md includes: Protagonist section with Want/Need/Fear/Wound
8. world.md includes: Setting, Rules (physical/social/economic)
9. style_guide.md includes: POV, Tense, Voice, Forbidden Phrases
10. timeline.md includes: Anchor Dates table, Constraints section
11. constraints.md includes: Must Include/Avoid, Genre Constraints, Continuity Rules
</verification>
</task>

<task id="01-02-02">
<description>
Create the /novel:init command skill with comprehensive validation.

Build init.md following Claude Code command pattern (.claude/commands/*.md):
- YAML frontmatter with allowed-tools, description
- <role> section: Init Agent persona
- <commands> section: Usage table with /novel:init variants
- <execution> section: Sequential numbered steps
- <examples> section: User interaction examples
- <edge_cases> section: Error handling scenarios

Execution steps (based on research lines 73-90):
1. Pre-flight validation (check if initialized, write permissions, disk space)
2. Parse arguments (--diary, --interactive, title)
3. Create directory structure (canon, state, beats, draft + subdirs)
4. Copy default state files from schemas to state/
5. Copy canon templates to canon/
6. If --interactive: Run questionnaire and populate templates
7. Initialize git + .gitignore if git enabled
8. Display success message with next steps

Validation (research lines 1098-1318):
- Check if already initialized (canon/ exists)
- Verify write permissions
- Validate format argument (chapter/diary/short/serial)
- Validate title length (1-200 chars)
- Post-creation validation (all directories created, JSON valid)
- Graceful cleanup on failure
</description>

<files>
- claude_src/novel/commands/init.md
</files>

<verification>
1. init.md exists with valid YAML frontmatter
2. YAML includes allowed-tools: [Read, Write, Bash, Glob]
3. <role> section defines Init Agent clearly
4. <commands> table documents: /novel:init, /novel:init --diary, /novel:init "Title"
5. <execution> has 7+ numbered steps matching research
6. Step 1 checks if already initialized (detects canon/ directory)
7. Step 2 parses arguments and validates format enum
8. Step 3 creates all 4 directories + draft subdirectories
9. Step 4 copies default state files (uses state-manager from 01-01)
10. Step 5 copies canon templates
11. Step 6 handles --interactive questionnaire (optional)
12. Step 7 git init + .gitignore creation
13. <edge_cases> includes: already initialized, no permissions, invalid format
14. <examples> shows at least 3 usage examples
15. Error messages are actionable (tell user how to fix)
</verification>
</task>

<task id="01-02-03">
<description>
Create .gitignore template for novel projects.

Define files to exclude from git:
- Temporary/cache files (.novel_cache/, state/.backup/)
- OS files (.DS_Store, Thumbs.db)
- Editor files (*.swp, .vscode/, .idea/)
- Build artifacts (if applicable)

Follow GSD pattern (research lines 1013-1030).
</description>

<files>
- claude_src/novel/templates/.gitignore
</files>

<verification>
1. .gitignore template exists
2. Includes .novel_cache/ exclusion
3. Includes state/.backup/ exclusion
4. Includes OS file exclusions (.DS_Store, Thumbs.db)
5. Includes editor exclusions (*.swp, *.swo, .vscode/, .idea/)
6. Includes comment headers explaining each section
7. No overly broad patterns (avoid ignoring user files)
</verification>
</task>

<task id="01-02-04">
<description>
Add interactive questionnaire logic to init.md.

If user provides --interactive flag, ask these questions (research lines 1219-1262):
1. Project Format: chapter / diary / short / serial
2. Project Title: (validate 1-200 chars)
3. Genre: fantasy / scifi / romance / thriller / literary / other
4. Target Length: (e.g., "50000 words", "26 entries")
5. POV: first / third_limited / third_omniscient
6. Tense: past / present

After answers collected:
- Show summary and confirm
- Populate templates with answers
- Save to state files (story_state.json, style_state.json)

Design as conversational prompts, not bash `read` commands (Claude Code context).
</description>

<files>
- claude_src/novel/commands/init.md (update Step 6)
</files>

<verification>
1. init.md Step 6 includes interactive questionnaire logic
2. All 6 questions present in order
3. Each question validates input against enum or constraints
4. Summary display shows all collected values
5. Confirmation prompt before proceeding (default: yes)
6. Values written to appropriate state/canon files
7. Non-interactive mode (default) skips questionnaire entirely
8. --interactive flag documented in <commands> section
</verification>
</task>

<task id="01-02-05">
<description>
Create symlink or copy mechanism to make command discoverable.

Claude Code commands live in .claude/commands/. Create novel/ subdirectory:
- .claude/commands/novel/init.md (symlink to claude_src/novel/commands/init.md)

If symlinks not supported (Windows), document copy strategy.
</description>

<files>
- .claude/commands/novel/init.md (symlink or copy)
</files>

<verification>
1. .claude/commands/novel/ directory exists
2. init.md accessible at .claude/commands/novel/init.md
3. File points to claude_src/novel/commands/init.md (symlink preferred)
4. Running `/novel:init` from Claude Code CLI works
5. Command appears in skill list
</verification>
</task>

<task id="01-02-06">
<description>
Test /novel:init end-to-end in clean directory.

Create test scenario:
1. Fresh directory with no existing novel project
2. Run /novel:init "Test Novel"
3. Verify all directories created
4. Verify all state files created with valid JSON
5. Verify all canon templates created
6. Verify git initialized (if git available)
7. Verify .gitignore created
8. Run /novel:init again (should fail with helpful error)

Document test results in verification section.
</description>

<files>
- (No new files, testing existing implementation)
</files>

<verification>
1. Create /tmp/novel-test/ directory
2. Run: /novel:init "Test Novel"
3. Verify directories exist: canon/, state/, beats/, draft/scenes/, draft/chapters/
4. Verify state files: ls state/*.json (should show 4 files)
5. Verify canon files: ls canon/*.md (should show 6 files)
6. Validate JSON: jq empty state/*.json (should succeed)
7. Verify git: ls .git/ (should exist if git available)
8. Run /novel:init again (should fail with "already initialized" error)
9. Check error message is actionable (suggests /novel:status or new directory)
</verification>
</task>

---

## must_haves

This plan MUST deliver:

1. **6 Canon Templates:** All templates self-documenting with examples
2. **/novel:init Command:** Fully functional initialization skill
3. **Argument Validation:** --diary, --interactive, title validation
4. **Interactive Mode:** Optional questionnaire for guided setup
5. **Git Integration:** Automatic git init + .gitignore creation
6. **Error Handling:** Graceful failures with actionable messages
7. **End-to-End Test:** Successful init in clean directory

**User Experience:** First-time user runs `/novel:init` and gets a working project in <5 seconds.

---

## Verification Criteria

### Pass Criteria

✓ All 6 canon templates exist and include inline examples
✓ init.md exists with all 7 execution steps documented
✓ /novel:init creates all 4 directories + subdirectories
✓ /novel:init copies all state files and canon templates
✓ /novel:init validates arguments (format, title)
✓ /novel:init prevents re-initialization with helpful error
✓ --interactive mode runs questionnaire and populates templates
✓ .gitignore template exists and excludes appropriate files
✓ Command accessible at .claude/commands/novel/init.md
✓ End-to-end test passes in clean directory

### Verification Commands

```bash
# Test init command
mkdir /tmp/novel-test && cd /tmp/novel-test
/novel:init "Test Novel"

# Verify structure
ls -R  # Should show: canon/, state/, beats/, draft/scenes/, draft/chapters/

# Verify state files
jq empty state/*.json && echo "All state files valid"

# Verify canon templates
wc -l canon/*.md  # Each should have 40+ lines (with inline help)

# Test re-init prevention
/novel:init "Another Novel"  # Should fail with helpful error
```

### Fail Criteria

✗ Any canon template missing or lacks inline examples
✗ init.md missing execution steps
✗ /novel:init fails to create all directories
✗ /novel:init allows re-initialization (no validation)
✗ Error messages are unclear or not actionable
✗ State files invalid JSON after init
✗ --interactive mode not functional

---

## Dependencies

**Depends on:**
- Plan 01-01 (needs state schemas, default state files, directory templates)

**Enables:**
- Plan 01-03 (/novel:status) - needs initialized project to report on
- Phase 02 (Planning Pipeline) - needs canon templates to read

---

## Notes

- Canon templates are the most important deliverable—they define the user interface
- Follow research specifications exactly (lines 505-913) for template structure
- Interactive mode is optional but valuable for first-time users
- Validation must be comprehensive—bad init state breaks everything
- Error messages should guide users to solutions, not just report problems
- Test in clean directory to ensure no hidden dependencies
- Git integration should degrade gracefully if git not available
