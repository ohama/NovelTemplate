---
phase: 02-planning-pipeline
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - claude_src/novel/agents/plot-planner.md
autonomous: true

must_haves:
  truths:
    - "plot-planner agent reads premise.md and characters.md to understand story"
    - "plot-planner generates beats/outline.md with act structure"
    - "plot-planner determines 3-act vs 5-act based on target length and complexity"
    - "plot-planner updates story_state.json with outline progress"
  artifacts:
    - path: "claude_src/novel/agents/plot-planner.md"
      provides: "Agent definition for outline generation"
      min_lines: 200
      contains: ["<role>", "<execution>", "Save the Cat", "3-act"]
  key_links:
    - from: "plot-planner agent"
      to: "canon/premise.md"
      via: "Read tool"
      pattern: "Read.*premise\\.md"
    - from: "plot-planner agent"
      to: "beats/outline.md"
      via: "Write tool with outline structure"
      pattern: "Write.*outline\\.md"
    - from: "plot-planner agent"
      to: "story_state.json"
      via: "state-manager skill update"
      pattern: "progress\\.outline.*complete"
---

<objective>
Create the plot-planner agent that generates high-level story structure from canon files.

Purpose: Automates outline generation using proven story frameworks (Save the Cat, 3-act structure), enabling writers to quickly iterate on story structure without manual beat sheet creation.

Output: plot-planner agent skill that transforms canon files into structured outline.md with act breakdown, chapter summaries, and character arc placement.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-planning-pipeline/02-RESEARCH.md
@claude_src/novel/utils/state-manager.md
@claude_src/novel/skills/git-integration.md
@claude_src/novel/schemas/story_state.schema.json
@claude_src/novel/schemas/character_state.schema.json
</context>

<tasks>

<task type="auto">
  <name>Create plot-planner agent with Save the Cat integration</name>
  <files>claude_src/novel/agents/plot-planner.md</files>
  <action>
Create agent definition file following Phase 1 patterns (from git-integration.md, state-manager.md).

**Structure:**
```markdown
---
name: plot-planner
description: Generate story outline from canon using proven story structure frameworks
allowed-tools: [Read, Write, Bash]
---

<role>
You are the Plot Planner Agent. Your job:
1. Read canon files (premise, characters, world) to understand story
2. Determine appropriate structure (3-act or 5-act)
3. Generate beats/outline.md with act breakdown and chapter summaries
4. Update story_state.json with outline progress

You are meticulous about story consistency and provide clear act/chapter structure.
</role>

<execution>

## Step 1: Validate Input

Read required canon files and check they exist:
1. Read canon/premise.md - if missing, ERROR and exit
2. Read canon/characters.md - if missing, ERROR and exit
3. Read canon/world.md (optional)
4. Read state/story_state.json - get project.format, project.title, project.target_length

## Step 2: Analyze Story (Prompt Chaining)

Prompt 1: Analyze premise.md
- Extract: Core concept, theme, story question, ending type

Prompt 2: Analyze characters.md
- Extract: Protagonist, antagonist, character arcs, relationships

Prompt 3: Determine structure
- If target_length < 50000 words: Use 3-act
- If target_length >= 50000 AND (5+ major characters OR multiple subplots): Use 5-act
- Otherwise: Default to 3-act

## Step 3: Generate Outline

Apply Save the Cat beat sheet to chosen structure:

**For 3-act:**
- Act 1 (25%): Setup, Catalyst, Break into Two
- Act 2 (50%): B Story, Midpoint, All Is Lost
- Act 3 (25%): Break into Three, Finale, Final Image

**For 5-act:**
- Act 1 (20%): Exposition
- Act 2 (20%): Rising Action
- Act 3 (20%): Climax
- Act 4 (20%): Falling Action
- Act 5 (20%): Resolution

Generate beats/outline.md with:
- Act summaries
- Chapter breakdown (estimate: target_words / 2000 per scene / 3 scenes per chapter)
- Major plot points
- Character arc placement

**Use outline format from 02-RESEARCH.md (lines 471-546).**

## Step 4: Update State

Use state-manager skill to update story_state.json:
1. Set progress.outline = "complete"
2. Set metadata.structure_type = "3-act" or "5-act"
3. Add any open_threads introduced in outline
4. Save state

## Step 5: Output Success

Report to user:
- Structure chosen (3-act or 5-act) with rationale
- Chapter count
- Act breakdown
- beats/outline.md location

</execution>

<validation>

After generating outline.md:
1. Verify file exists at beats/outline.md
2. Check file contains all acts for chosen structure
3. Verify story_state.json updated with progress.outline = "complete"
4. Confirm no canon contradictions

</validation>
```

**Key implementation notes:**
- Use progressive disclosure pattern (brief instructions + references to RESEARCH.md)
- Follow state-manager skill pattern for JSON updates
- Error handling: Check file existence before reading
- No git commit (that's handled by orchestrating command in Plan 04)
  </action>
  <verify>
1. Check file exists: `ls claude_src/novel/agents/plot-planner.md`
2. Verify structure: `grep -c "<role>" claude_src/novel/agents/plot-planner.md` returns 1
3. Check Save the Cat mentioned: `grep -i "save the cat" claude_src/novel/agents/plot-planner.md`
4. Verify state-manager usage: `grep "state-manager" claude_src/novel/agents/plot-planner.md`
  </verify>
  <done>
plot-planner.md exists with complete agent definition including role, execution steps (validate, analyze, generate, update state), and validation section. Agent references Save the Cat beat sheet and uses state-manager skill for JSON updates.
  </done>
</task>

</tasks>

<verification>

After plan completion:
- [ ] plot-planner.md exists in claude_src/novel/agents/
- [ ] Agent definition includes all required sections (role, execution, validation)
- [ ] References 3-act and 5-act structures
- [ ] Uses state-manager skill pattern from Phase 1
- [ ] Follows progressive disclosure pattern (< 500 lines)

</verification>

<success_criteria>

Plan 02-01 complete when:
- plot-planner agent created with full definition
- Agent can be spawned by orchestrating command
- Clear execution steps for outline generation
- State update logic included
- Ready for integration in /novel:outline command (Plan 04)

</success_criteria>

<output>
After completion, create `.planning/phases/02-planning-pipeline/02-01-SUMMARY.md`
</output>
