---
phase: 02-planning-pipeline
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - claude_src/novel/agents/diary-planner.md
autonomous: true

must_haves:
  truths:
    - "diary-planner generates date-based planning for diary format stories"
    - "diary-planner maps entries to timeline with seasonal progression"
    - "diary-planner schedules growth milestones from constraints.md"
    - "diary-planner outputs beats/diary_plan.md with temporal structure"
  artifacts:
    - path: "claude_src/novel/agents/diary-planner.md"
      provides: "Agent definition for diary format planning"
      min_lines: 150
      contains: ["<role>", "<execution>", "diary", "date", "seasonal"]
  key_links:
    - from: "diary-planner agent"
      to: "canon/timeline.md"
      via: "Read tool for date constraints"
      pattern: "Read.*timeline\\.md"
    - from: "diary-planner agent"
      to: "beats/diary_plan.md"
      via: "Write tool with date mapping"
      pattern: "Write.*diary_plan\\.md"
    - from: "diary-planner agent"
      to: "story_state.json"
      via: "state-manager skill for diary metadata"
      pattern: "diary_metadata"
---

<objective>
Create the diary-planner agent that adds temporal structure for diary format stories.

Purpose: Specializes planning for diary format by mapping entries to specific dates, tracking seasonal progression, and scheduling character growth milestones across the timeline.

Output: diary-planner agent skill that generates beats/diary_plan.md with date assignments, seasonal arcs, and growth milestone scheduling for diary-specific narratives.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-planning-pipeline/02-RESEARCH.md
@claude_src/novel/utils/state-manager.md
@claude_src/novel/schemas/story_state.schema.json
@claude_src/novel/schemas/timeline_state.schema.json
</context>

<tasks>

<task type="auto">
  <name>Create diary-planner agent with temporal structure generation</name>
  <files>claude_src/novel/agents/diary-planner.md</files>
  <action>
Create agent definition following Phase 1 patterns.

**Structure:**
```markdown
---
name: diary-planner
description: Generate date-based planning for diary format stories with seasonal arcs and growth milestones
allowed-tools: [Read, Write, Bash]
---

<role>
You are the Diary Planner Agent. Your job:
1. Read beats/outline.md and canon/timeline.md to understand story timeline
2. Map diary entries to specific dates across the timeline
3. Plan seasonal progression and environmental changes
4. Schedule growth milestones from canon/constraints.md
5. Generate beats/diary_plan.md with temporal structure

You specialize in diary format constraints: dated entries, seasonal arcs, first-person retrospective tone.
</role>

<execution>

## Step 1: Validate Input

Check required files:
1. Read beats/outline.md - if missing, ERROR "Run /novel:outline first"
2. Read canon/timeline.md - get start_date, end_date, fixed_events
3. Read canon/constraints.md - get growth milestones
4. Read state/story_state.json - verify format == "diary"

## Step 2: Calculate Timeline Structure

From timeline.md and outline.md:
1. Parse start_date and end_date (ISO 8601 format: YYYY-MM-DD)
2. Calculate total duration (days/weeks/months)
3. Count total scenes from outline
4. Calculate entry frequency:
   - Baseline: 2 entries per week
   - Crisis periods (Act 2 midpoint, climax): 3-4 entries per week
   - Reflection periods: 1 entry per week

## Step 3: Map Entries to Dates

For each scene in outline:
1. Assign entry date based on frequency pattern
2. Determine season (from date: Mar-May spring, Jun-Aug summer, Sep-Nov fall, Dec-Feb winter)
3. Note weather progression (early spring cold/rainy â†’ late spring warming, etc.)
4. Map to chapter from outline

## Step 4: Plan Seasonal Arcs

For each season in timeline:
1. Identify entry date range
2. Map to character arc stages (from character_state.json)
3. Note environmental changes (weather, daylight, natural events)
4. Set mood progression across season

## Step 5: Schedule Growth Milestones

From constraints.md:
1. Identify growth milestones (achievements, breakthroughs, crises)
2. Map to specific entry dates aligned with story structure
3. Track arc impact (how milestone changes character)

## Step 6: Generate diary_plan.md

Create beats/diary_plan.md with:

**Use diary_plan format from 02-RESEARCH.md (lines 614-692).**

Key sections:
- Timeline table (Entry #, Date, Season, Chapter, Summary)
- Seasonal progression (date ranges, arc stages, weather, mood)
- Growth milestones (date, entry #, milestone, arc impact)
- Entry pattern analysis (frequency variations, narrative distance shifts)
- Date-based constraints (from timeline.md)

## Step 7: Update State

Use state-manager skill:
1. Add diary_metadata to story_state.json:
   - start_date, end_date
   - entry_count
   - date_range_days
2. Update timeline_state.json with entry dates
3. Set progress.diary_plan = "complete"

## Step 8: Output Summary

Report to user:
- Date range (start to end)
- Total entries and frequency
- Seasonal breakdown
- Growth milestones scheduled
- beats/diary_plan.md location

</execution>

<validation>

After generating diary_plan.md:
1. Verify file exists at beats/diary_plan.md
2. Check all dates are ISO 8601 format and within timeline.md range
3. Verify seasonal progression makes sense (no summer in December for Northern Hemisphere)
4. Confirm growth milestones align with story structure
5. Check story_state.json has diary_metadata

</validation>

<notes>

**Conditional invocation:** This agent only runs when story_state.json has format == "diary". The orchestrating command (/novel:outline in Plan 04) checks format before spawning.

**Integration with beat-planner:** If diary-planner runs, beat-planner should read diary_plan.md to align scene beats with entry dates.

</notes>
```

**Implementation notes:**
- Only runs for diary format projects (conditional in orchestrator)
- Uses ISO 8601 date format (YYYY-MM-DD) for consistency
- Seasonal calculation based on Northern Hemisphere (can be edited by user)
- Entry frequency heuristic from research: 2/week baseline, varies by story intensity
  </action>
  <verify>
1. Check file exists: `ls claude_src/novel/agents/diary-planner.md`
2. Verify role section: `grep -c "<role>" claude_src/novel/agents/diary-planner.md` returns 1
3. Check date handling: `grep "ISO 8601" claude_src/novel/agents/diary-planner.md`
4. Verify diary metadata: `grep "diary_metadata" claude_src/novel/agents/diary-planner.md`
  </verify>
  <done>
diary-planner.md exists with complete agent definition including role, execution steps (validate, calculate timeline, map entries, plan seasons, schedule milestones, generate plan, update state), and validation. Agent handles diary-specific temporal planning with date assignments and seasonal arcs.
  </done>
</task>

</tasks>

<verification>

After plan completion:
- [ ] diary-planner.md exists in claude_src/novel/agents/
- [ ] Agent definition includes role, execution, validation, notes sections
- [ ] Date mapping and seasonal planning logic documented
- [ ] ISO 8601 date format specified
- [ ] Updates story_state and timeline_state
- [ ] Conditional execution note included

</verification>

<success_criteria>

Plan 02-03 complete when:
- diary-planner agent created with full definition
- Temporal structure generation documented
- Seasonal arc planning included
- Growth milestone scheduling logic present
- Ready for conditional integration in /novel:outline command (Plan 04)

</success_criteria>

<output>
After completion, create `.planning/phases/02-planning-pipeline/02-03-SUMMARY.md`
</output>
