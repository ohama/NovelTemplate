---
phase: 02-planning-pipeline
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - claude_src/novel/agents/beat-planner.md
autonomous: true

must_haves:
  truths:
    - "beat-planner reads beats/outline.md to understand chapter structure"
    - "beat-planner generates scene-level beat sheets in beats/scenes/*.md"
    - "Each beat sheet includes POV, goals, conflict, outcome, emotional beat"
    - "beat-planner updates character_state.json with scene appearances"
  artifacts:
    - path: "claude_src/novel/agents/beat-planner.md"
      provides: "Agent definition for scene beat generation"
      min_lines: 200
      contains: ["<role>", "<execution>", "scene beat", "POV"]
  key_links:
    - from: "beat-planner agent"
      to: "beats/outline.md"
      via: "Read tool"
      pattern: "Read.*outline\\.md"
    - from: "beat-planner agent"
      to: "beats/scenes/*.md"
      via: "Write tool with scene beat structure"
      pattern: "Write.*beats/scenes/"
    - from: "beat-planner agent"
      to: "character_state.json"
      via: "state-manager skill update for scene tracking"
      pattern: "scene_appearances"
---

<objective>
Create the beat-planner agent that converts chapter outlines into detailed scene-level beat sheets.

Purpose: Transforms high-level outline into actionable scene specifications with POV, character goals, conflicts, and emotional beats, providing clear structure for draft writing phase.

Output: beat-planner agent skill that generates beats/scenes/*.md files following the scene beat format from research, ready for scene-writer consumption in Phase 3.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-planning-pipeline/02-RESEARCH.md
@claude_src/novel/utils/state-manager.md
@claude_src/novel/schemas/story_state.schema.json
@claude_src/novel/schemas/character_state.schema.json
</context>

<tasks>

<task type="auto">
  <name>Create beat-planner agent with scene beat generation</name>
  <files>claude_src/novel/agents/beat-planner.md</files>
  <action>
Create agent definition following Phase 1 skill patterns.

**Structure:**
```markdown
---
name: beat-planner
description: Convert outline into scene-level beat sheets with POV, goals, conflict, emotional beats
allowed-tools: [Read, Write, Bash]
---

<role>
You are the Beat Planner Agent. Your job:
1. Read beats/outline.md to understand chapter structure
2. Break each chapter into 2-5 scenes based on pacing
3. Generate beats/scenes/chXX_sYY.md files with scene specifications
4. Update character_state.json with scene appearances

You create detailed but brief scene beats (150-300 words) - planning notes, NOT prose.
</role>

<execution>

## Step 1: Validate Input

Check required files exist:
1. Read beats/outline.md - if missing, ERROR "Run /novel:outline first"
2. Read canon/characters.md - for character details
3. Read state/story_state.json - get format, structure_type
4. Read state/character_state.json - get character arcs

## Step 2: Process Each Chapter

For each chapter in outline.md:

1. Identify chapter's narrative purpose (from outline)
2. Determine scene count (2-5 scenes based on chapter complexity and pacing notes)
3. For each scene:
   - Assign scene ID: ch[XX]_s[YY] (zero-padded, e.g., ch01_s01, ch02_s03)
   - Determine POV character (rotate if multiple POV, respect style_state.json)
   - Define scene goal, conflict, outcome
   - Set emotional beat and pacing (fast/medium/slow)
   - Note continuity (what precedes, what follows)

## Step 3: Generate Scene Beat Sheets

For each scene, create beats/scenes/chXX_sYY.md with frontmatter + structure:

**Use scene beat format from 02-RESEARCH.md (lines 549-608).**

Key sections:
- Frontmatter (id, chapter, scene, status: "planned", POV)
- Purpose (story goal, character goal, thematic resonance)
- Structure (opening, conflict, turning point, outcome)
- Character Notes (who appears, emotional states, development)
- Emotional Beat (target emotion, pacing)
- Continuity Notes (follows/leads-to, timeline, location)
- Drafting Notes (estimated length, key details, what to avoid)

**Keep beats brief:** 150-300 words per scene. Use bullet points and planning language, NOT prose.

## Step 4: Update State

Use state-manager skill:

1. Update story_state.json:
   - Add each scene to scene_index with status "planned"
   - Set progress.beat_plan = "complete"

2. Update character_state.json:
   - For each character appearing in scenes, add scene IDs to scene_appearances array
   - Track arc progression (which scenes advance character arc)

## Step 5: Output Summary

Report to user:
- Total scenes generated
- Scenes per chapter breakdown
- POV distribution
- beats/scenes/ directory location

</execution>

<validation>

After generating beat sheets:
1. Verify beats/scenes/ directory exists
2. Count .md files matches expected scene count
3. Verify each file has valid frontmatter with scene ID
4. Check story_state.json updated with all scene IDs
5. Confirm character_state.json has scene_appearances for all characters

</validation>
```

**Implementation notes:**
- Scene IDs use chXX_sYY pattern (zero-padded for sorting)
- Beat sheets are PLANNING notes, not prose (warn against over-detail)
- Update both story_state and character_state for consistency tracking
- Error if outline.md missing (dependency on plot-planner output)
  </action>
  <verify>
1. Check file exists: `ls claude_src/novel/agents/beat-planner.md`
2. Verify role section: `grep -c "<role>" claude_src/novel/agents/beat-planner.md` returns 1
3. Check scene ID pattern: `grep "ch.*_s" claude_src/novel/agents/beat-planner.md`
4. Verify state updates: `grep "character_state.json" claude_src/novel/agents/beat-planner.md`
  </verify>
  <done>
beat-planner.md exists with complete agent definition including role, execution steps (validate, process chapters, generate beats, update state), and validation. Agent generates scene beat sheets following research format, tracking POV and character appearances.
  </done>
</task>

</tasks>

<verification>

After plan completion:
- [ ] beat-planner.md exists in claude_src/novel/agents/
- [ ] Agent definition includes role, execution, validation sections
- [ ] Scene beat format matches research specification
- [ ] Updates both story_state and character_state
- [ ] Follows progressive disclosure pattern

</verification>

<success_criteria>

Plan 02-02 complete when:
- beat-planner agent created with full definition
- Scene beat generation logic documented
- State update procedures included
- Scene ID pattern (chXX_sYY) implemented
- Ready for integration in /novel:outline command (Plan 04)

</success_criteria>

<output>
After completion, create `.planning/phases/02-planning-pipeline/02-02-SUMMARY.md`
</output>
