---
phase: 05-revision-loop
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - claude_src/novel/agents/novel-editor.md
  - claude_src/novel/agents/novel-quality-gate.md
autonomous: true

must_haves:
  truths:
    - "Editor agent synthesizes 5 checker reports into 3-5 prioritized improvement areas"
    - "Quality gate agent applies objective criteria to approve/reject scenes"
    - "Editorial letter follows Must/Should/Could framework for actionable feedback"
    - "Quality decisions are based on configurable thresholds (0 CRITICAL, 2 MAJOR max)"
  artifacts:
    - path: "claude_src/novel/agents/novel-editor.md"
      provides: "Editorial synthesis agent"
      min_lines: 250
      contains: "Must Fix (Critical)"
    - path: "claude_src/novel/agents/novel-quality-gate.md"
      provides: "Quality gate decision agent"
      min_lines: 200
      contains: "critical_threshold"
  key_links:
    - from: "novel-editor.md"
      to: "check_reports/[timestamp]/*.json"
      via: "Read checker JSON outputs"
      pattern: "Read.*check_reports"
    - from: "novel-quality-gate.md"
      to: "quality_criteria"
      via: "Load approval thresholds"
      pattern: "critical_threshold.*major_threshold"
---

<objective>
Build editor and quality gate agents that transform Phase 4 checker outputs into actionable editorial feedback and objective approval decisions.

Purpose: Enable iterative quality improvement through AI-synthesized editorial guidance and automated approval gating.

Output: Two agent definitions following established Novel Engine patterns, consuming checker JSON and producing editorial letters + quality decisions.
</objective>

<execution_context>
@./.claude/get-shit-done/workflows/execute-plan.md
@./.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-revision-loop/05-RESEARCH.md
@.planning/phases/04-quality-checks/04-03-SUMMARY.md
@claude_src/novel/agents/canon-checker.md
@claude_src/novel/commands/check.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build novel-editor agent</name>
  <files>claude_src/novel/agents/novel-editor.md</files>
  <action>
Create novel-editor agent following the agent template pattern from existing checkers (canon-checker.md structure).

Agent structure:
- Frontmatter: name, description, allowed-tools: [Read, Write], version: 1.0
- Role section: Editorial synthesis responsibilities, Must/Should/Could framework
- Execution section with 5 steps:
  1. Load Checker Reports: Read all 5 JSON files from check_reports/[timestamp]/
  2. Analyze Patterns: Group issues by scene, by type, identify cross-cutting patterns
  3. Prioritize Improvements: Apply Must/Should/Could framework based on story impact
  4. Generate Editorial Letter: Format following research template (What Works Well, Must Fix, Should Fix, Could Fix, Revision Plan, Next Steps)
  5. Write Output: Save to check_reports/[timestamp]/editorial_letter.md

Key implementation details (from RESEARCH.md Pattern 2):
- Must Fix: All CRITICAL severity + high-impact MAJOR issues
- Should Fix: MAJOR severity affecting story quality
- Could Fix: MINOR severity and polish items
- Select 3-5 top priorities maximum (avoid overwhelm)
- Include "What Works Well" section (1-3 items from passed checks)
- Provide specific scene references and actionable fix strategies
- Output format: Markdown editorial letter with clear sections

Validation section:
- Check all 5 checker JSONs loaded successfully
- Editorial letter has all required sections
- Priorities limited to 3-5 items
- Each priority includes scene references and fix strategy

Examples section:
- Example editorial letter from RESEARCH.md (Run 42.195 marathon diary)
- Show Must/Should/Could categorization
- Demonstrate actionable suggestions vs vague critique

Notes section:
- Editor synthesizes only from checker findings (no new critique beyond checkers)
- Tone is constructive and balanced (what works + what needs work)
- Fiction editorial best practices: focus on story impact, reader experience
  </action>
  <verify>cat claude_src/novel/agents/novel-editor.md | grep -c "Must Fix" returns >0, file exists with complete role/execution/validation structure</verify>
  <done>novel-editor.md exists with 250+ lines, includes all 5 execution steps, follows agent template pattern, contains Must/Should/Could framework</done>
</task>

<task type="auto">
  <name>Task 2: Build novel-quality-gate agent</name>
  <files>claude_src/novel/agents/novel-quality-gate.md</files>
  <action>
Create novel-quality-gate agent following the agent template pattern.

Agent structure:
- Frontmatter: name, description, allowed-tools: [Read, Write], version: 1.0
- Role section: Objective approval decision-making based on configurable criteria
- Execution section with 4 steps:
  1. Load Quality Criteria: Read state/quality_criteria.json or use defaults (critical_threshold: 0, major_threshold: 2, minor_threshold: 999, auto_rewrite: false)
  2. Evaluate Each Scene: Count issues by severity, apply thresholds, determine APPROVED or NEEDS_REVISION per scene
  3. Determine Overall Status: CRITICAL_ISSUES if any CRITICAL, NEEDS_REVISION if any scene fails, APPROVED if all pass
  4. Generate Output: Write check_reports/[timestamp]/quality_decision.json with structured decision data

Key implementation details (from RESEARCH.md Pattern 3):
- CRITICAL issues always block approval (hard gate) - threshold 0
- MAJOR issues may block based on configurable threshold (soft gate) - default 2 per scene
- MINOR issues are advisory only (no blocking)
- Scene-level granularity (approve/reject per scene, not whole manuscript)
- Each decision includes clear reasoning and blocking issues list
- Default criteria if quality_criteria.json missing

Decision structure per scene:
```json
{
  "scene_id": "ch03_s02",
  "decision": "NEEDS_REVISION" | "APPROVED",
  "reason": "2 MAJOR issues exceed threshold of 2",
  "blocking_issues": [ ... ],
  "advisory_issues": [ ... ]
}
```

Overall output structure:
```json
{
  "timestamp": "ISO 8601",
  "overall_status": "CRITICAL_ISSUES" | "NEEDS_REVISION" | "APPROVED",
  "criteria_used": { critical_threshold, major_threshold, minor_threshold },
  "scenes_evaluated": count,
  "scenes_approved": count,
  "scenes_need_revision": count,
  "summary": { critical: count, major: count, minor: count },
  "scene_decisions": [ ... ],
  "recommended_actions": [ ... ]
}
```

Validation section:
- Quality criteria loaded (default or custom)
- All scenes from checker reports evaluated
- Each decision has reasoning
- Overall status matches scene-level decisions

Examples section:
- Example quality_decision.json from RESEARCH.md
- Show scene-level decisions with blocking issues
- Demonstrate threshold application logic

Notes section:
- Decisions are objective based on criteria, not subjective
- Thresholds are configurable per project/genre via state/quality_criteria.json
- Scene-level decisions enable progressive approval (some pass, some fail)
  </action>
  <verify>cat claude_src/novel/agents/novel-quality-gate.md | grep -c "critical_threshold" returns >0, file exists with JSON output structure</verify>
  <done>novel-quality-gate.md exists with 200+ lines, includes all 4 execution steps, contains default criteria, outputs structured quality_decision.json</done>
</task>

</tasks>

<verification>
After task completion:
- [ ] novel-editor.md exists with complete agent structure
- [ ] novel-quality-gate.md exists with complete agent structure
- [ ] Both agents follow established pattern (compare to canon-checker.md)
- [ ] Editor produces editorial_letter.md with Must/Should/Could sections
- [ ] Quality gate produces quality_decision.json with scene decisions
- [ ] Both agents use Read/Write tools only (no state mutations)
</verification>

<success_criteria>
- Both agent definition files exist in claude_src/novel/agents/
- Editor agent synthesizes checker findings into 3-5 prioritized improvements
- Quality gate agent applies objective thresholds to scene approval
- Agent structures match established pattern (frontmatter, role, execution, validation, examples)
- Ready for integration into /novel:check pipeline (Plan 05-02)
</success_criteria>

<output>
After completion, create `.planning/phases/05-revision-loop/05-01-SUMMARY.md`
</output>
